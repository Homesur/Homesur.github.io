<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="text-center mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
    <div class="card p-4 shadow-sm mb-4">
      <h4 class="mb-3">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h4>
      <div class="mb-3">
        <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
        <input type="text" id="name" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Oppo Reno 8">
      </div>
      <div class="mb-3">
        <label for="price" class="form-label">–¶–µ–Ω–∞ (MDL)</label>
        <input type="number" id="price" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 300">
      </div>
      <button class="btn btn-success w-100" id="addBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </div>

    <!-- –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
    <div class="card p-4 shadow-sm mb-4">
      <h4 class="mb-3">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID</h4>
      <div class="mb-3">
        <label for="deleteId" class="form-label">ID —Ç–æ–≤–∞—Ä–∞</label>
        <input type="number" id="deleteId" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1697040000000">
      </div>
      <button class="btn btn-danger w-100" id="deleteBtn">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="status" class="text-center mt-4 fw-bold"></div>

    <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="card p-4 shadow-sm mt-5">
      <h4 class="mb-3">–í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –±–∞–∑–µ</h4>
      <div id="productList" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA_WAUmHLsgGKd-0T0w22mjsIh_mkXuOc4",
      authDomain: "isota-ed295.firebaseapp.com",
      databaseURL: "https://isota-ed295-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "isota-ed295",
      storageBucket: "isota-ed295.firebasestorage.app",
      messagingSenderId: "658102298792",
      appId: "1:658102298792:web:fbc90679e3adadcac93a9d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const nameInput = document.getElementById('name');
    const priceInput = document.getElementById('price');
    const deleteIdInput = document.getElementById('deleteId');
    const status = document.getElementById('status');
    const productList = document.getElementById('productList');

    function showMessage(message, success = true) {
      status.textContent = message;
      status.className = `text-center mt-4 fw-bold ${success ? 'text-success' : 'text-danger'}`;
    }

    document.getElementById('addBtn').addEventListener('click', () => {
      const name = nameInput.value.trim();
      const price = parseFloat(priceInput.value);

      if (!name || isNaN(price)) {
        showMessage("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", false);
        return;
      }

      const id = Date.now();
      set(ref(db, 'products/' + id), { id, name, price })
        .then(() => {
          showMessage("‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!");
          nameInput.value = "";
          priceInput.value = "";
        })
        .catch(err => {
          showMessage("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: " + err.message, false);
        });
    });

    document.getElementById('deleteBtn').addEventListener('click', () => {
      const id = deleteIdInput.value.trim();
      if (!id) {
        showMessage("–í–≤–µ–¥–∏—Ç–µ ID —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è", false);
        return;
      }

      remove(ref(db, 'products/' + id))
        .then(() => {
          showMessage("üóëÔ∏è –¢–æ–≤–∞—Ä —Å ID " + id + " —É–¥–∞–ª—ë–Ω");
          deleteIdInput.value = "";
        })
        .catch(err => {
          showMessage("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: " + err.message, false);
        });
    });

    function loadProducts() {
      onValue(ref(db, 'products'), (snapshot) => {
        const products = snapshot.val();
        productList.innerHTML = '';

        if (!products) {
          productList.innerHTML = '<p class="text-muted">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±–∞–∑–µ</p>';
          return;
        }

        Object.values(products).forEach(p => {
          const card = document.createElement('div');
          card.className = 'col';
          card.innerHTML = `
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">${p.name}</h5>
                <p class="card-text">ID: ${p.id}</p>
                <p class="card-text">–¶–µ–Ω–∞: ${p.price.toFixed(2)} MDL</p>
              </div>
            </div>
          `;
          productList.appendChild(card);
        });
      });
    }

    loadProducts();
  </script>
</body>
</html>
