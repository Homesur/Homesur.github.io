<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"></script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="text-center mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>

    <div class="card p-4 shadow-sm mb-4">
      <h4 class="mb-3">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h4>
      <input type="text" id="name" class="form-control mb-2" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
      <input type="number" id="price" class="form-control mb-2" placeholder="–¶–µ–Ω–∞ (MDL)">
      <button class="btn btn-success w-100" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="card p-4 shadow-sm mb-4">
      <h4 class="mb-3">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID</h4>
      <input type="number" id="deleteId" class="form-control mb-2" placeholder="ID —Ç–æ–≤–∞—Ä–∞">
      <button class="btn btn-danger w-100" onclick="deleteProduct()">–£–¥–∞–ª–∏—Ç—å</button>
    </div>

    <div id="status" class="text-center mt-4 fw-bold"></div>

    <div class="card p-4 shadow-sm mt-5">
      <h4 class="mb-3">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</h4>
      <ul id="productList" class="list-group"></ul>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_WAUmHLsgGKd-0T0w22mjsIh_mkXuOc4",
      authDomain: "isota-ed295.firebaseapp.com",
      databaseURL: "https://isota-ed295-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "isota-ed295",
      storageBucket: "isota-ed295.firebasestorage.app",
      messagingSenderId: "658102298792",
      appId: "1:658102298792:web:fbc90679e3adadcac93a9d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    console.log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");

    const status = document.getElementById('status');
    const productList = document.getElementById('productList');

    function showMessage(msg, success = true) {
      status.textContent = msg;
      status.className = `text-center mt-4 fw-bold ${success ? 'text-success' : 'text-danger'}`;
    }

    function addProduct() {
      const name = document.getElementById('name').value.trim();
      const price = parseFloat(document.getElementById('price').value);
      if (!name || isNaN(price)) {
        showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", false);
        return;
      }

      const id = Date.now();
      console.log("üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:", { id, name, price });

      db.ref('products/' + id).set({ id, name, price })
        .then(() => {
          showMessage("‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω");
          document.getElementById('name').value = "";
          document.getElementById('price').value = "";
          loadProducts();
        })
        .catch(err => {
          console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏:", err);
          showMessage("–û—à–∏–±–∫–∞: " + err.message, false);
        });
    }

    function deleteProduct() {
      const id = document.getElementById('deleteId').value.trim();
      if (!id) {
        showMessage("‚ùå –í–≤–µ–¥–∏—Ç–µ ID", false);
        return;
      }

      console.log("üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID:", id);
      db.ref('products/' + id).remove()
        .then(() => {
          showMessage("üóëÔ∏è –¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω");
          document.getElementById('deleteId').value = "";
          loadProducts();
        })
        .catch(err => {
          console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:", err);
          showMessage("–û—à–∏–±–∫–∞: " + err.message, false);
        });
    }

    function loadProducts() {
      db.ref('products').once('value').then(snapshot => {
        const products = snapshot.val();
        productList.innerHTML = '';

        if (!products) {
          productList.innerHTML = '<li class="list-group-item text-muted">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</li>';
          return;
        }

        Object.values(products).forEach(p => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `
            <div>
              <strong>${p.name}</strong><br>
              <small>ID: ${p.id}</small>
            </div>
            <span class="badge bg-primary rounded-pill">${p.price.toFixed(2)} MDL</span>
          `;
          productList.appendChild(li);
        });
      }).catch(err => {
        console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:", err);
        showMessage("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + err.message, false);
      });
    }

    loadProducts();
  </script>
</body>
</html>
